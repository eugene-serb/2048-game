(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,o=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===t(o)?o:String(o)),i)}var o}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}const n=r((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.getRandomInteger=function(t,e){return Math.floor(Math.random()*(e-t)+t)}}));function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function a(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(t,e,r){return(e=l(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===i(e)?e:String(e)}const u=a((function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,"update",(function(t){r.balance=t,r.draw()})),c(this,"draw",(function(){r.$container.innerText="Score: ".concat(r.balance)})),this.$container=e,this.balance=0,this.draw()}));function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==f(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===f(i)?i:String(i)),n)}var i}var p=new WeakSet;function y(){this.timeNow=Date.now();var t=this.timeNow-this.timeStart,e=Math.floor(t/1e3),r=0;e>=60&&(e-=60*(r=Math.floor(e/60))),r=r<10?"0".concat(r):"".concat(r),e=e<10?"0".concat(e):"".concat(e),this.time="".concat(r,":").concat(e)}const b=function(){function t(e){var r,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(r=this,n=p),n.add(r),this.$container=e,this.time="00:00",this.timeStart=Date.now(),this.timeNow=this.timeStart,this.draw()}var e,r;return e=t,(r=[{key:"draw",value:function(){(function(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r})(this,p,y).call(this),this.$container.innerText="Time: ".concat(this.time)}}])&&s(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,w(n.key),n)}}function m(t,e,r){return e&&h(t.prototype,e),r&&h(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function w(t){var e=function(t,e){if("object"!==v(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===v(e)?e:String(e)}const d=m((function t(e,r,n){var i,o,a,c=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,a=function(){document.querySelector('[x = "'.concat(c.x,'"][y = "').concat(c.y,'"]')).classList.add("tile","tile-"+c.cost),document.querySelector('[x = "'.concat(c.x,'"][y = "').concat(c.y,'"]')).innerText=c.cost},(o=w(o="draw"))in i?Object.defineProperty(i,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[o]=a,this.x=e,this.y=r,this.cost=n,this.draw()}));function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,R(n.key),n)}}function T(t,e,r){return e&&S(t.prototype,e),r&&S(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function P(t,e,r){return(e=R(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function R(t){var e=function(t,e){if("object"!==g(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===g(e)?e:String(e)}const E=T((function t(e,r,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),P(this,"generateMatrix",(function(t,e){for(var r=new Array,n=0;n<t;n++){r[n]=new Array;for(var i=0;i<e;i++)r[n][i]=0}return r})),P(this,"draw",(function(){i.$container.innerHTML="";var t=document.createElement("div");t.classList.add("map"),i.$container.appendChild(t);for(var e=i.matrix_height-1;e>=0;e--)for(var r=0;r<i.matrix_width;r++){var n=document.createElement("div");n.classList.add("cell"),n.setAttribute("x",r),n.setAttribute("y",e),t.appendChild(n)}})),this.$container=e,this.matrix_width=r,this.matrix_height=n,this.matrix=this.generateMatrix(this.matrix_width,this.matrix_height),this.draw()}));function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function A(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,k(n.key),n)}}function I(t,e,r){return e&&A(t.prototype,e),r&&A(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _(t,e,r){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,r)}function W(t,e,r){return(e=k(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function k(t){var e=function(t,e){if("object"!==M(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===M(e)?e:String(e)}function j(t,e){var r=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}(t,e);return function(t,e){return e.get?e.get.call(t):e.value}(t,r)}var H=new WeakMap,O=new WeakMap,x=new WeakMap,D=new WeakMap,L=new WeakMap,$=new WeakMap,X=new WeakMap,G=new WeakMap,C=new WeakMap,q=new WeakMap,U=new WeakMap,K=new WeakMap,N=new WeakMap;new(I((function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),W(this,"init",(function(){e.map=new E(e.$MAP_WRAPPER,e.MATRIX_WIDTH,e.MATRIX_HEIGHT),e.score=new u(e.$SCORE_WRAPPER),e.timer=new b(e.$TIMER_WRAPPER),e.tiles=e.map.matrix,j(e,H).call(e),j(e,H).call(e),j(e,x).call(e),e.$DIALOG_WRAPPER.innerHTML="Get 2048!",e.interval=setInterval(e.draw,1e3)})),W(this,"draw",(function(){e.map.draw(),e.score.draw(),e.timer.draw();for(var t=0;t<=3;t++)for(var r=0;r<=3;r++)0!==e.tiles[t][r]&&e.tiles[t][r].draw()})),_(this,H,{writable:!0,value:function(){if(0!==j(e,O).call(e)){for(var t=new Array,r=0;r<e.MATRIX_WIDTH;r++)for(var n=0;n<e.MATRIX_HEIGHT;n++)0===e.tiles[r][n]&&t.push([r,n]);var i=e.support.getRandomInteger(0,t.length),o=2*e.support.getRandomInteger(1,3),a=t[i][0],c=t[i][1];e.tiles[a][c]=new d(a,c,o)}}}),_(this,O,{writable:!0,value:function(){for(var t=0,r=0;r<e.MATRIX_WIDTH;r++)for(var n=0;n<e.MATRIX_HEIGHT;n++)0===e.tiles[r][n]&&t++;return t}}),_(this,x,{writable:!0,value:function(){for(var t=0,r=0;r<e.MATRIX_WIDTH;r++)for(var n=0;n<e.MATRIX_HEIGHT;n++)0!==e.tiles[r][n]&&(t+=e.tiles[r][n].cost);e.score.update(t)}}),_(this,D,{writable:!0,value:function(){for(var t=0,r=0;r<e.MATRIX_WIDTH;r++)for(var n=0;n<e.MATRIX_HEIGHT;n++)0===e.tiles[r][n]&&t++,n<3&&e.tiles[r][n].cost===e.tiles[r][n+1].cost&&t++,r<3&&e.tiles[r][n].cost===e.tiles[r+1][n].cost&&t++;0===t&&(e.$DIALOG_WRAPPER.innerText="Game Over!",clearInterval(e.interval))}}),_(this,L,{writable:!0,value:function(){for(var t=0;t<e.MATRIX_WIDTH;t++)for(var r=0;r<e.MATRIX_HEIGHT;r++)0!==e.tiles[t][r]&&(e.tiles[t][r].x=t,e.tiles[t][r].y=r)}}),_(this,$,{writable:!0,value:function(t){for(var e=0;e<t.length;e++)0===t[e]&&(t.splice(e,1),e--);t.length>1&&t.forEach((function(e,r){void 0!==t[r-1]&&e.cost===t[r-1].cost&&(t[r-1].cost*=2,t.splice(r,1))}));for(var r=1;r<=4;r++)4!=t.length&&t.push(0);return t}}),_(this,X,{writable:!0,value:function(t){for(var r=0,n=0;n<=3;n++){var i=[],o=[];switch(t){case"Up":for(var a=3;a>=0;a--)i.push(e.tiles[n][a]),o.push(e.tiles[n][a]);break;case"Down":for(var c=0;c<=3;c++)i.push(e.tiles[n][c]),o.push(e.tiles[n][c]);break;case"Left":for(var l=0;l<=3;l++)i.push(e.tiles[l][n]),o.push(e.tiles[l][n]);break;case"Right":for(var u=3;u>=0;u--)i.push(e.tiles[u][n]),o.push(e.tiles[u][n])}i=j(e,$).call(e,i);for(var f=0;f<=i.length;f++)i[f]!==o[f]&&r++;switch(t){case"Up":for(var s=3;s>=0;s--)e.tiles[n][s]=i.shift();break;case"Down":for(var p=0;p<=3;p++)e.tiles[n][p]=i.shift();break;case"Left":for(var y=0;y<=3;y++)e.tiles[y][n]=i.shift();break;case"Right":for(var b=3;b>=0;b--)e.tiles[b][n]=i.shift()}}j(e,L).call(e),e.draw(),r>0&&j(e,H).call(e),e.draw(),j(e,x).call(e),j(e,D).call(e)}}),_(this,G,{writable:!0,value:function(){window.addEventListener("keydown",(function(t){"ArrowUp"===t.code||"KeyW"===t.code?j(e,X).call(e,"Up"):"ArrowDown"===t.code||"KeyS"===t.code?j(e,X).call(e,"Down"):"ArrowLeft"===t.code||"KeyA"===t.code?j(e,X).call(e,"Left"):"ArrowRight"===t.code||"KeyD"===t.code?j(e,X).call(e,"Right"):"KeyR"===t.code&&(clearInterval(e.interval),e.init())}))}}),_(this,C,{writable:!0,value:function(){var t=0;"getGamepads"in window.navigator&&window.addEventListener("gamepadconnected",(function(){setInterval((function(){t+=10;var r,n=navigator.getGamepads(),i=!1;n[0].buttons.forEach((function(t,e){1===t.value&&(r=e,i=!0)})),i&&function(r){if(t>=250){switch(r){case 3:clearInterval(e.interval),e.init();break;case 12:j(e,X).call(e,"Up");break;case 13:j(e,X).call(e,"Down");break;case 14:j(e,X).call(e,"Left");break;case 15:j(e,X).call(e,"Right")}t=0}}(r)}),10)}))}}),_(this,q,{writable:!0,value:function(){var t=0,r=0,n=0,i=0;e.$MAP_WRAPPER.addEventListener("touchstart",(function(e){t=e.touches[0].pageX,r=e.touches[0].pageY})),e.$MAP_WRAPPER.addEventListener("touchend",(function(o){n=o.changedTouches[0].pageX,i=o.changedTouches[0].pageY;var a=n-t,c=i-r,l=Math.abs(a)>Math.abs(c),u=Math.abs(c)>Math.abs(a);a>0&&l?j(e,X).call(e,"Right"):a<0&&l?j(e,X).call(e,"Left"):c>0&&u?j(e,X).call(e,"Down"):c<0&&u&&j(e,X).call(e,"Up")}))}}),_(this,U,{writable:!0,value:function(){e.MATRIX_WIDTH=4,e.MATRIX_HEIGHT=4}}),_(this,K,{writable:!0,value:function(){e.$MAP_WRAPPER=document.querySelector(".game-2048__map-wrapper"),e.$SCORE_WRAPPER=document.querySelector(".game-2048__score"),e.$TIMER_WRAPPER=document.querySelector(".game-2048__timer"),e.$DIALOG_WRAPPER=document.querySelector(".game-2048__dialog")}}),_(this,N,{writable:!0,value:function(){j(e,G).call(e),j(e,C).call(e),j(e,q).call(e)}}),j(this,U).call(this),j(this,K).call(this),j(this,N).call(this),this.support=new n,this.init()})))})();